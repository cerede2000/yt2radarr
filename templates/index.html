<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YT2Radarr - Radarr Video Importer</title>
  <link
    rel="icon"
    type="image/svg+xml"
    sizes="any"
    href="{{ url_for('static', filename='yt2radarr-logo.svg') }}"
  />
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body
  data-debug-mode="{{ 'true' if debug_mode else 'false' }}"
  data-console-visible="true"
>
  <div class="app-shell">
    <div class="header">
      <div class="brand">
        <img
          src="{{ url_for('static', filename='yt2radarr-logo.svg') }}"
          alt="YT2Radarr logo"
          class="app-logo"
        />
        <h1>YT2Radarr - Radarr Video Importer</h1>
      </div>
      <div class="header-actions">
        <button
          type="button"
          id="themeToggleButton"
          class="button-secondary theme-toggle-button"
          aria-pressed="false"
          title="Switch to light mode"
        >
          ðŸŒž Light Mode
        </button>
        <button
          type="button"
          id="toggleConsoleButton"
          class="button-secondary toggle-console-button"
          aria-controls="debugConsoleRegion"
          aria-expanded="true"
        >
          Hide Console
        </button>
        <a class="link-button" href="{{ url_for('setup') }}">Settings</a>
      </div>
    </div>

    <div class="page-layout">
      <div class="main-column">
        <form id="movieForm" novalidate>
          <div class="form-group">
            <label for="yturl">Video URL</label>
            <div class="youtube-input-wrapper">
              <input
                type="url"
                id="yturl"
                name="yturl"
                placeholder="https://www.youtube.com/watch?v=..."
                pattern="^(https?:\\/\\/)?(?:(?:www|m)\\.)?(?:youtube\\.com|youtu\\.be|vimeo\\.com|player\\.vimeo\\.com|dailymotion\\.com|dai\\.ly)\\/.*$"
                required
              />
              <button type="button" class="button-secondary" id="youtubeSearchButton">
                Search YouTube
              </button>
            </div>
          </div>

          <div class="form-group">
            <label for="movieName">Movie</label>
            <div class="movie-input-wrapper">
              <input
                list="movieOptions"
                id="movieName"
                name="movieName"
                placeholder="Start typing movie title..."
                autocomplete="off"
                required
              />
              <button type="button" class="button-secondary" id="refreshLibraryButton">
                Refresh Library
              </button>
              <datalist id="movieOptions">
                {% for movie in movies %}
                  <option
                    data-id="{{ movie['id'] }}"
                    data-title="{{ movie['title'] }}"
                    data-year="{{ movie.get('year', '') }}"
                    data-tmdb="{{ movie.get('tmdbId', '') }}"
                    value="{{ movie['title'] }}{% if movie.get('year') %} ({{ movie['year'] }}){% endif %}"
                  ></option>
                {% endfor %}
              </datalist>
            </div>
          </div>
          <input type="hidden" id="movieId" name="movieId" />

          <div class="movie-feedback" id="movieFeedback" role="status" aria-live="polite" hidden></div>

          <div class="movie-not-found" id="movieNotFoundPrompt" hidden>
            <span>Movie not found. Add to Radarr?</span>
            <button type="button" class="button-ghost" id="movieNotFoundButton">
              Yes, search Radarr
            </button>
          </div>

          <div class="form-check">
            <input type="checkbox" id="standalone" name="standalone" />
            <label for="standalone">Download without Radarr (create standalone folder)</label>
          </div>
          <p class="help-text" id="standaloneHelp">
            By default, we'll create a folder using the video title inside your first
            configured library path.
          </p>
          <div class="standalone-options" id="standaloneNamingOptions" hidden>
            <div class="form-check">
              <input type="checkbox" id="standaloneCustomNameToggle" name="standaloneCustomNameToggle" />
              <label for="standaloneCustomNameToggle">Use a custom folder and filename</label>
            </div>
            <div class="form-group" id="standaloneCustomNameGroup" hidden>
              <label for="standaloneCustomName">Custom Name</label>
              <input
                type="text"
                id="standaloneCustomName"
                name="standaloneCustomName"
                placeholder="Folder and video name"
              />
              <p class="help-text">
                We'll create the folder and saved video file using this name.
              </p>
            </div>
          </div>

          <div class="form-check">
            <input type="checkbox" id="extra" name="extra" />
            <label for="extra">Store in subfolder (treat as extra)</label>
          </div>

          <div class="form-group">
            <label for="playlistMode">Playlist Handling</label>
            <select id="playlistMode" name="playlistMode">
              <option value="single" selected>Download only this video</option>
              <option value="merge">Download entire playlist and merge into a single file</option>
            </select>
          </div>

          <div id="extraFields" style="display: none;">
            <div class="form-group">
              <label for="extraType">Extra Type</label>
              <select id="extraType" name="extraType">
                <option value="trailer" selected>Trailer</option>
                <option value="behindthescenes">Behind the Scenes</option>
                <option value="deleted">Deleted Scene</option>
                <option value="featurette">Featurette</option>
                <option value="interview">Interview</option>
                <option value="scene">Scene</option>
                <option value="short">Short</option>
                <option value="other">Other</option>
              </select>
            </div>

            <div class="form-group">
              <label for="extra_name">Extra Name</label>
              <input
                type="text"
                id="extra_name"
                name="extra_name"
                placeholder="e.g., Official Teaser"
              />
            </div>
          </div>

          <details class="advanced-options">
            <summary>Advanced Options</summary>
            <div class="advanced-content">
              <div class="advanced-group">
                <h3>Movie Metadata Overrides</h3>
                <p class="help-text">
                  These values default to the selected Radarr movie. Override them here only if you
                  need custom metadata for the download.
                </p>
                <div class="form-group">
                  <label for="title">Movie Title</label>
                  <input type="text" id="title" name="title" placeholder="Movie Title" />
                </div>

                <div class="form-group">
                  <label for="year">Year</label>
                  <input type="text" id="year" name="year" placeholder="e.g., 2010" />
                </div>

                <div class="form-group">
                  <label for="tmdb">TMDb ID</label>
                  <input type="text" id="tmdb" name="tmdb" placeholder="Optional TMDb ID" />
                </div>
              </div>
            </div>
          </details>

          <button type="submit">Download Video</button>
        </form>

        <section class="activity-panel" aria-live="polite">
          <div class="panel-header">
            <h2>Downloads &amp; Processes</h2>
          </div>
          <div id="downloadsList" class="downloads-list empty">
            <div class="empty-state">No downloads yet.</div>
          </div>
        </section>
      </div>

      <aside class="side-column" id="debugConsoleRegion">
        <div class="console-header">
          <h2>Debug Console</h2>
          <button type="button" id="copyLogButton" class="copy-log-button" hidden>Copy Full Log</button>
        </div>
        <div id="console" class="debug-console">Ready.</div>
      </aside>
    </div>
  </div>

  <div id="addRadarrModal" class="modal" hidden>
    <div class="modal-backdrop" id="addRadarrBackdrop" data-close-add-movie="true"></div>
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="addRadarrTitle">
      <div class="modal-header">
        <h3 id="addRadarrTitle">Add movie to Radarr</h3>
        <button
          type="button"
          class="button-ghost close-button"
          data-close-add-movie="true"
          aria-label="Close"
        >
          Ã—
        </button>
      </div>
      <div class="modal-body">
        <div class="modal-search">
          <label for="addRadarrSearch">Search for a movie title</label>
          <div class="modal-search-input">
            <input
              type="text"
              id="addRadarrSearch"
              name="addRadarrSearch"
              placeholder="Enter at least 2 characters"
              autocomplete="off"
              spellcheck="false"
            />
            <button type="button" class="button-secondary" id="addRadarrSearchButton">
              Search
            </button>
          </div>
        </div>
        <div id="addRadarrStatus" class="modal-status" role="status" aria-live="polite"></div>
        <ul id="addRadarrResults" class="modal-results"></ul>
        <div id="addRadarrPreview" class="modal-preview" hidden>
          <div class="poster-wrapper">
            <img id="addRadarrPoster" alt="Selected movie poster" hidden />
          </div>
          <div class="preview-details">
            <h4 id="addRadarrPreviewTitle">Select a movie</h4>
            <p id="addRadarrPreviewMeta" class="preview-meta"></p>
            <p id="addRadarrPreviewOverview" class="preview-overview"></p>
            <div class="modal-actions">
              <button type="button" class="button-primary" id="addRadarrConfirm" disabled>
                Add to Radarr
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="youtubeSearchModal" class="modal" hidden>
    <div
      class="modal-backdrop"
      id="youtubeSearchBackdrop"
      data-close-youtube-search="true"
    ></div>
    <div
      class="modal-dialog"
      role="dialog"
      aria-modal="true"
      aria-labelledby="youtubeSearchTitle"
    >
      <div class="modal-header">
        <h3 id="youtubeSearchTitle">Search YouTube</h3>
        <button
          type="button"
          class="button-ghost close-button"
          data-close-youtube-search="true"
          aria-label="Close"
        >
          Ã—
        </button>
      </div>
      <div class="modal-body">
        <div class="modal-search">
          <label for="youtubeSearchInput">Search for a video</label>
          <div class="modal-search-input">
            <input
              type="text"
              id="youtubeSearchInput"
              name="youtubeSearchInput"
              placeholder="Enter at least 2 characters"
              autocomplete="off"
              spellcheck="false"
            />
            <button type="button" class="button-secondary" id="youtubeSearchSubmit">
              Search
            </button>
          </div>
        </div>
        <div
          id="youtubeSearchStatus"
          class="modal-status"
          role="status"
          aria-live="polite"
        ></div>
        <ul id="youtubeSearchResults" class="modal-results" hidden></ul>
      </div>
    </div>
  </div>
  <script src="{{ url_for('static', filename='script.js') }}" defer></script>
</body>
</html>
